# VM到期管理系统 - 测试用例文档

## 文档信息
- **项目名称**: VM到期管理系统
- **文档版本**: 1.0
- **创建日期**: 2026-01-06
- **测试环境**: http://localhost:3000
- **测试账户**: 
  - 管理员: admin@example.com / admin123
  - 普通用户: user@example.com / user123

## 目录
1. [登录/认证测试](#1-登录认证测试)
2. [仪表板页面测试](#2-仪表板页面测试)
3. [VM管理页面测试](#3-vm管理页面测试)
4. [项目管理页面测试](#4-项目管理页面测试)
5. [用户管理页面测试](#5-用户管理页面测试)
6. [审计日志页面测试](#6-审计日志页面测试)
7. [权限控制测试](#7-权限控制测试)
8. [数据导出测试](#8-数据导出测试)

---

## 1. 登录/认证测试

### TC-AUTH-001: 管理员登录成功
**测试目标**: 验证管理员可以成功登录系统
**前置条件**: 系统运行正常，数据库已初始化
**测试步骤**:
1. 访问 http://localhost:3000
2. 点击"登录"按钮
3. 输入邮箱: admin@example.com
4. 输入密码: admin123
5. 点击"登录"按钮

**预期结果**:
- 成功跳转到仪表板页面 (/dashboard)
- 页面显示"欢迎回来, 系统管理员"
- 显示"管理员"标签
- 导航栏显示所有管理功能（VM管理、项目管理、用户管理、审计日志）

**验证属性**: Property 1, Property 2
**关联需求**: Requirements 1.1, 1.2

---

### TC-AUTH-002: 普通用户登录成功
**测试目标**: 验证普通用户可以成功登录系统
**前置条件**: 系统运行正常，数据库已初始化
**测试步骤**:
1. 访问 http://localhost:3000
2. 点击"登录"按钮
3. 输入邮箱: user@example.com
4. 输入密码: user123
5. 点击"登录"按钮

**预期结果**:
- 成功跳转到仪表板页面
- 页面显示"欢迎回来, 普通用户"
- 不显示"管理员"标签
- 导航栏只显示有限功能（VM管理、项目管理）
- 不显示用户管理和审计日志菜单

**验证属性**: Property 1, Property 3
**关联需求**: Requirements 1.1, 1.3

---

### TC-AUTH-003: 登录失败 - 错误凭据
**测试目标**: 验证错误凭据无法登录
**前置条件**: 系统运行正常
**测试步骤**:
1. 访问登录页面
2. 输入邮箱: wrong@example.com
3. 输入密码: wrongpassword
4. 点击"登录"按钮

**预期结果**:
- 登录失败
- 显示错误提示信息
- 停留在登录页面
- 不创建会话

**验证属性**: Property 1
**关联需求**: Requirements 1.1

---

### TC-AUTH-004: 用户登出
**测试目标**: 验证用户可以成功登出系统
**前置条件**: 用户已登录
**测试步骤**:
1. 以任意用户身份登录
2. 点击右上角用户头像
3. 点击"登出"按钮

**预期结果**:
- 会话被清除
- 重定向到登录页面
- 无法通过浏览器后退按钮访问受保护页面

**验证属性**: Property 6
**关联需求**: Requirements 1.6

---

## 2. 仪表板页面测试

### TC-DASH-001: 管理员仪表板显示
**测试目标**: 验证管理员仪表板显示所有统计信息
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 登录为管理员
2. 查看仪表板页面

**预期结果**:
- 显示欢迎信息和管理员标签
- 显示4个统计卡片：
  - 即将到期VM (7天内到期)
  - 总VM数量
  - 项目数量
  - 用户数量
- 显示3个快速操作卡片：
  - VM管理
  - 项目管理
  - 审计日志
- 显示最近活动列表
- 所有数据正确显示

**验证属性**: Property 2
**关联需求**: Requirements 1.2, 8.1

---

### TC-DASH-002: 普通用户仪表板显示
**测试目标**: 验证普通用户仪表板显示受限信息
**前置条件**: 以普通用户身份登录
**测试步骤**:
1. 登录为普通用户
2. 查看仪表板页面

**预期结果**:
- 显示欢迎信息，无管理员标签
- 显示3个统计卡片（不包含用户数量）
- 显示2个快速操作卡片（不包含审计日志）
- 显示最近活动列表
- 只显示用户有权限访问的数据

**验证属性**: Property 3, Property 4
**关联需求**: Requirements 1.3, 1.4

---

## 3. VM管理页面测试

### TC-VM-001: 查看VM列表（管理员）
**测试目标**: 验证管理员可以查看所有VM记录
**前置条件**: 以管理员身份登录，系统中存在VM记录
**测试步骤**:
1. 登录为管理员
2. 点击导航栏"VM管理"
3. 查看VM列表页面

**预期结果**:
- 显示所有VM记录
- 每条记录显示：邮箱、VM账户、内网IP、域名、项目、到期时间、状态
- 显示到期状态标识（正常/即将到期/已过期）
- 显示"新建VM"按钮
- 显示筛选条件区域
- 显示导出按钮（CSV/JSON）
- 显示批量操作选择框

**验证属性**: Property 9
**关联需求**: Requirements 2.3, 8.1

---

### TC-VM-002: 查看VM列表（普通用户）
**测试目标**: 验证普通用户只能查看分配项目的VM
**前置条件**: 以普通用户身份登录
**测试步骤**:
1. 登录为普通用户
2. 点击导航栏"VM管理"
3. 查看VM列表

**预期结果**:
- 只显示用户被分配项目的VM记录
- 不显示其他项目的VM
- 不显示"新建VM"按钮
- 不显示批量操作选择框
- 可以查看VM详情

**验证属性**: Property 4, Property 9, Property 40
**关联需求**: Requirements 1.4, 2.4, 9.2

---

### TC-VM-003: 创建新VM记录
**测试目标**: 验证管理员可以创建新的VM记录
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 进入VM管理页面
2. 点击"新建VM"按钮
3. 填写表单：
   - 邮箱: test@example.com
   - VM账户: vm-test-001
   - 内网IP: 192.168.1.100
   - VM域名: test.example.com
   - 选择项目: 项目A
   - 到期时间: 2026-04-01
4. 点击"创建"按钮

**预期结果**:
- VM记录创建成功
- 返回VM列表页面
- 新记录显示在列表中
- 所有字段正确保存
- 创建操作记录到审计日志

**验证属性**: Property 7, Property 8
**关联需求**: Requirements 2.1, 2.6

---
### TC-VM-004: 创建VM - 数据验证失败
**测试目标**: 验证VM创建时的数据验证
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 进入VM管理页面
2. 点击"新建VM"按钮
3. 尝试提交空表单或无效数据

**预期结果**:
- 显示验证错误信息
- 必填字段标记为错误
- 邮箱格式验证
- IP地址格式验证
- 到期时间必须是未来日期
- 不创建记录

**验证属性**: Property 11, Property 15
**关联需求**: Requirements 2.6, 3.4

---

### TC-VM-005: 编辑VM记录
**测试目标**: 验证管理员可以编辑VM记录
**前置条件**: 以管理员身份登录，存在VM记录
**测试步骤**:
1. 进入VM管理页面
2. 点击某个VM的"编辑"按钮
3. 修改VM信息（如更改域名）
4. 点击"保存"按钮

**预期结果**:
- VM记录更新成功
- 返回VM列表或详情页
- 修改后的信息正确显示
- 更新操作记录到审计日志
- 更新时间字段更新

**验证属性**: Property 8
**关联需求**: Requirements 2.2

---

### TC-VM-006: 删除VM记录
**测试目标**: 验证管理员可以删除VM记录
**前置条件**: 以管理员身份登录，存在可删除的VM记录
**测试步骤**:
1. 进入VM管理页面
2. 点击某个VM的"删除"按钮
3. 确认删除操作

**预期结果**:
- 显示确认对话框
- 确认后VM记录被删除
- 记录从列表中移除
- 删除操作记录到审计日志

**验证属性**: Property 10
**关联需求**: Requirements 2.5

---

### TC-VM-007: VM筛选 - 按项目
**测试目标**: 验证按项目筛选VM功能
**前置条件**: 登录系统，存在多个项目的VM
**测试步骤**:
1. 进入VM管理页面
2. 在"项目"下拉框中选择"项目A"
3. 查看筛选结果

**预期结果**:
- 只显示属于"项目A"的VM记录
- 其他项目的VM不显示
- 筛选条件正确应用
- 显示筛选后的记录数量

**验证属性**: Property 35
**关联需求**: Requirements 11.1

---

### TC-VM-008: VM筛选 - 按到期状态
**测试目标**: 验证按到期状态筛选VM功能
**前置条件**: 登录系统，存在不同到期状态的VM
**测试步骤**:
1. 进入VM管理页面
2. 在"到期状态"下拉框中选择"即将到期"
3. 查看筛选结果

**预期结果**:
- 只显示7天内到期的VM记录
- 正常和已过期的VM不显示
- 状态标识正确显示

**验证属性**: Property 36
**关联需求**: Requirements 11.2

---

### TC-VM-009: VM搜索功能
**测试目标**: 验证VM搜索功能
**前置条件**: 登录系统，存在VM记录
**测试步骤**:
1. 进入VM管理页面
2. 在搜索框输入邮箱、账户或域名关键字
3. 查看搜索结果

**预期结果**:
- 显示匹配搜索关键字的VM记录
- 支持模糊搜索
- 搜索邮箱、VM账户、域名字段
- 实时更新搜索结果

**验证属性**: Property 37, Property 38
**关联需求**: Requirements 11.3, 11.4

---

### TC-VM-010: 组合筛选条件
**测试目标**: 验证多个筛选条件同时使用
**前置条件**: 登录系统，存在多条VM记录
**测试步骤**:
1. 进入VM管理页面
2. 选择项目: "项目A"
3. 选择到期状态: "即将到期"
4. 输入搜索关键字
5. 查看结果

**预期结果**:
- 显示同时满足所有条件的VM记录
- 筛选逻辑为AND关系
- 结果准确无误

**验证属性**: Property 39
**关联需求**: Requirements 11.5

---
### TC-VM-011: 清除筛选条件
**测试目标**: 验证清除筛选功能
**前置条件**: 已应用筛选条件
**测试步骤**:
1. 进入VM管理页面
2. 应用多个筛选条件
3. 点击"清除筛选"按钮

**预期结果**:
- 所有筛选条件重置为默认值
- 显示所有VM记录（权限范围内）
- 搜索框清空

---

### TC-VM-012: 批量选择VM
**测试目标**: 验证批量选择VM功能
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 进入VM管理页面
2. 勾选多个VM的复选框
3. 查看批量操作提示

**预期结果**:
- 选中的VM高亮显示
- 显示已选择数量
- 显示批量操作按钮
- 可以取消选择

---

### TC-VM-013: 全选VM
**测试目标**: 验证全选功能
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 进入VM管理页面
2. 点击表头的全选复选框

**预期结果**:
- 当前页所有VM被选中
- 显示选中数量
- 再次点击取消全选

---

### TC-VM-014: 批量续期操作
**测试目标**: 验证批量续期功能
**前置条件**: 以管理员身份登录，已选择多个VM
**测试步骤**:
1. 选择多个VM记录
2. 点击"批量续期"按钮
3. 确认操作

**预期结果**:
- 所有选中的VM到期时间更新
- 更新为相同的新到期时间（当前到期时间+3个月）
- 每个VM生成独立的审计日志
- 显示操作成功提示
- 选择状态清除

**验证属性**: Property 13, Property 14
**关联需求**: Requirements 3.2, 3.3

---

### TC-VM-015: 批量操作失败回滚
**测试目标**: 验证批量操作失败时的回滚机制
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 选择多个VM
2. 模拟批量操作失败场景
3. 查看结果

**预期结果**:
- 所有更改被回滚
- 没有部分更新
- 显示错误信息
- 数据保持一致性

**验证属性**: Property 16
**关联需求**: Requirements 3.5

---

### TC-VM-016: 查看VM详情
**测试目标**: 验证VM详情页面显示
**前置条件**: 登录系统，存在VM记录
**测试步骤**:
1. 进入VM管理页面
2. 点击某个VM的"查看"按钮

**预期结果**:
- 显示VM完整信息
- 显示所属项目信息
- 显示创建时间和更新时间
- 显示到期历史记录
- 显示相关操作按钮

**验证属性**: Property 41
**关联需求**: Requirements 8.4

---

### TC-VM-017: VM到期状态显示
**测试目标**: 验证VM到期状态正确显示
**前置条件**: 存在不同到期状态的VM
**测试步骤**:
1. 进入VM管理页面
2. 查看不同VM的到期状态

**预期结果**:
- 已过期VM显示红色标识"已过期"
- 7天内到期VM显示黄色标识"即将到期"
- 正常VM显示绿色标识"正常"
- 显示剩余天数

---

## 4. 项目管理页面测试

### TC-PROJ-001: 查看项目列表
**测试目标**: 验证项目列表显示
**前置条件**: 登录系统，存在项目记录
**测试步骤**:
1. 点击导航栏"项目管理"
2. 查看项目列表页面

**预期结果**:
- 以卡片形式显示所有项目
- 每个项目显示：名称、描述、VM数量、用户数量、创建时间
- 管理员显示"新建项目"按钮
- 显示项目统计信息
- 显示导出按钮

**验证属性**: Property 33
**关联需求**: Requirements 10.4

---
### TC-PROJ-002: 创建新项目
**测试目标**: 验证管理员可以创建新项目
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 进入项目管理页面
2. 点击"新建项目"按钮
3. 填写表单：
   - 项目名称: 测试项目
   - 项目描述: 这是一个测试项目
4. 点击"创建项目"按钮

**预期结果**:
- 项目创建成功
- 对话框关闭
- 新项目显示在列表中
- 项目信息正确保存
- 创建操作记录到审计日志

**验证属性**: Property 30
**关联需求**: Requirements 10.1

---

### TC-PROJ-003: 创建项目 - 验证失败
**测试目标**: 验证项目创建的数据验证
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 点击"新建项目"
2. 不填写项目名称
3. 尝试提交

**预期结果**:
- 显示"项目名称是必填项"错误
- 不创建项目
- 对话框保持打开

---

### TC-PROJ-004: 编辑项目信息
**测试目标**: 验证管理员可以编辑项目
**前置条件**: 以管理员身份登录，存在项目
**测试步骤**:
1. 进入项目管理页面
2. 点击某个项目的"编辑"按钮
3. 修改项目名称或描述
4. 点击"保存"按钮

**预期结果**:
- 项目信息更新成功
- 返回项目列表
- 修改后的信息正确显示
- 更新操作记录到审计日志

**验证属性**: Property 31
**关联需求**: Requirements 10.2

---

### TC-PROJ-005: 删除项目 - 有关联VM
**测试目标**: 验证不能删除有关联VM的项目
**前置条件**: 以管理员身份登录，项目下有VM记录
**测试步骤**:
1. 进入项目管理页面
2. 尝试删除有VM的项目
3. 确认删除

**预期结果**:
- 显示错误提示"项目下有关联VM，无法删除"
- 项目不被删除
- 提示先删除或转移VM

**验证属性**: Property 32
**关联需求**: Requirements 10.3

---

### TC-PROJ-006: 删除项目 - 无关联VM
**测试目标**: 验证可以删除无关联VM的项目
**前置条件**: 以管理员身份登录，项目下无VM
**测试步骤**:
1. 创建一个新项目（不添加VM）
2. 点击删除按钮
3. 确认删除

**预期结果**:
- 显示确认对话框
- 项目成功删除
- 从列表中移除
- 删除操作记录到审计日志

**验证属性**: Property 32
**关联需求**: Requirements 10.3

---

### TC-PROJ-007: 查看项目详情
**测试目标**: 验证项目详情页面显示
**前置条件**: 登录系统，存在项目
**测试步骤**:
1. 进入项目管理页面
2. 点击某个项目的"查看详情"按钮

**预期结果**:
- 显示项目完整信息
- 显示项目下的所有VM列表
- 显示分配的用户列表
- 显示项目统计信息
- 管理员可以看到"分配用户"按钮

---

### TC-PROJ-008: 分配用户到项目
**测试目标**: 验证管理员可以分配用户到项目
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 进入项目详情页面
2. 点击"分配用户"按钮
3. 选择要分配的用户
4. 点击"确认"按钮

**预期结果**:
- 用户成功分配到项目
- 用户列表更新
- 用户可以访问该项目的VM
- 分配操作记录到审计日志

**验证属性**: Property 34
**关联需求**: Requirements 10.5

---

### TC-PROJ-009: 取消用户项目分配
**测试目标**: 验证管理员可以取消用户分配
**前置条件**: 以管理员身份登录，用户已分配到项目
**测试步骤**:
1. 进入项目详情页面
2. 点击某个用户的"移除"按钮
3. 确认操作

**预期结果**:
- 用户从项目中移除
- 用户列表更新
- 用户无法再访问该项目的VM
- 操作记录到审计日志

---

### TC-PROJ-010: 项目搜索功能
**测试目标**: 验证项目搜索功能
**前置条件**: 登录系统，存在多个项目
**测试步骤**:
1. 进入项目管理页面
2. 在搜索框输入项目名称或描述关键字
3. 查看搜索结果

**预期结果**:
- 显示匹配的项目
- 支持模糊搜索
- 搜索项目名称和描述字段
- 实时更新结果

---
### TC-PROJ-011: 项目统计信息
**测试目标**: 验证项目统计信息正确显示
**前置条件**: 登录系统，存在项目数据
**测试步骤**:
1. 进入项目管理页面
2. 滚动到页面底部查看统计信息

**预期结果**:
- 显示总项目数
- 显示总VM数
- 显示用户分配数
- 显示平均VM数/项目
- 所有统计数据准确

---

## 5. 用户管理页面测试

### TC-USER-001: 查看用户列表（管理员）
**测试目标**: 验证管理员可以查看所有用户
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 点击导航栏"用户管理"
2. 查看用户列表页面

**预期结果**:
- 显示所有系统用户
- 每个用户显示：头像、姓名、邮箱、角色、项目分配数、创建时间、最后更新时间
- 显示"新建用户"按钮
- 显示筛选条件
- 显示用户统计信息

**验证属性**: Property 25
**关联需求**: Requirements 6.1

---

### TC-USER-002: 用户管理页面访问控制
**测试目标**: 验证普通用户无法访问用户管理
**前置条件**: 以普通用户身份登录
**测试步骤**:
1. 尝试访问用户管理页面
2. 或查看导航栏

**预期结果**:
- 导航栏不显示"用户管理"菜单
- 直接访问URL被拒绝
- 显示权限不足提示或重定向

**验证属性**: Property 3
**关联需求**: Requirements 1.3

---

### TC-USER-003: 创建新用户
**测试目标**: 验证管理员可以创建新用户
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 进入用户管理页面
2. 点击"新建用户"按钮
3. 填写表单：
   - 邮箱: newuser@example.com
   - 姓名: 新用户
   - 密码: password123
   - 角色: 普通用户
4. 点击"创建用户"按钮

**预期结果**:
- 用户创建成功
- 对话框关闭
- 新用户显示在列表中
- 用户信息正确保存
- 创建操作记录到审计日志

---

### TC-USER-004: 创建用户 - 验证失败
**测试目标**: 验证用户创建的数据验证
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 点击"新建用户"
2. 尝试提交无效数据：
   - 空邮箱
   - 无效邮箱格式
   - 密码少于6个字符

**预期结果**:
- 显示相应的验证错误信息
- 不创建用户
- 对话框保持打开

---

### TC-USER-005: 修改用户角色
**测试目标**: 验证管理员可以修改用户角色
**前置条件**: 以管理员身份登录，存在普通用户
**测试步骤**:
1. 进入用户管理页面
2. 找到某个普通用户
3. 在角色下拉框中选择"管理员"
4. 确认修改

**预期结果**:
- 显示确认对话框
- 用户角色更新为管理员
- 角色标识更新
- 更新操作记录到审计日志
- 用户下次登录时拥有管理员权限

---

### TC-USER-006: 用户角色降级
**测试目标**: 验证可以将管理员降级为普通用户
**前置条件**: 以管理员身份登录，存在其他管理员
**测试步骤**:
1. 进入用户管理页面
2. 找到某个管理员用户（非当前用户）
3. 将角色改为"普通用户"
4. 确认修改

**预期结果**:
- 用户角色更新为普通用户
- 该用户权限立即受限
- 操作记录到审计日志

---

### TC-USER-007: 不能修改自己的角色
**测试目标**: 验证管理员不能修改自己的角色
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 进入用户管理页面
2. 查看当前登录用户的记录

**预期结果**:
- 当前用户的角色下拉框不显示或禁用
- 无法修改自己的角色

---

### TC-USER-008: 用户搜索功能
**测试目标**: 验证用户搜索功能
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 进入用户管理页面
2. 在搜索框输入邮箱或姓名关键字
3. 查看搜索结果

**预期结果**:
- 显示匹配的用户
- 支持模糊搜索
- 搜索邮箱和姓名字段
- 实时更新结果

---

### TC-USER-009: 按角色筛选用户
**测试目标**: 验证按角色筛选功能
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 进入用户管理页面
2. 在"用户角色"下拉框选择"管理员"
3. 查看筛选结果

**预期结果**:
- 只显示管理员用户
- 普通用户不显示
- 显示筛选后的数量

---

### TC-USER-010: 用户统计信息
**测试目标**: 验证用户统计信息正确显示
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 进入用户管理页面
2. 查看页面底部统计信息

**预期结果**:
- 显示总用户数
- 显示管理员数量
- 显示普通用户数量
- 显示项目分配总数
- 所有统计数据准确

---
## 6. 审计日志页面测试

### TC-AUDIT-001: 查看审计日志（管理员）
**测试目标**: 验证管理员可以查看所有审计日志
**前置条件**: 以管理员身份登录，系统中有操作记录
**测试步骤**:
1. 点击导航栏"审计日志"
2. 查看审计日志页面

**预期结果**:
- 显示所有系统操作记录
- 每条记录显示：时间、操作类型、实体类型、用户、变更内容、IP地址
- 显示筛选条件区域
- 显示"导出"和"刷新"按钮
- 显示分页控件

**验证属性**: Property 25
**关联需求**: Requirements 6.1

---

### TC-AUDIT-002: 审计日志访问控制
**测试目标**: 验证普通用户无法访问审计日志
**前置条件**: 以普通用户身份登录
**测试步骤**:
1. 尝试访问审计日志页面
2. 或查看导航栏

**预期结果**:
- 导航栏不显示"审计日志"菜单
- 直接访问URL被拒绝
- 显示权限不足提示

**验证属性**: Property 28
**关联需求**: Requirements 6.4

---

### TC-AUDIT-003: 操作自动记录
**测试目标**: 验证系统操作自动记录到审计日志
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 执行任意数据修改操作（如创建VM）
2. 进入审计日志页面
3. 查找刚才的操作记录

**预期结果**:
- 操作被自动记录
- 记录包含：操作类型、实体类型、实体ID、用户信息、时间戳、变更内容
- 记录准确完整

**验证属性**: Property 26
**关联需求**: Requirements 6.2

---

### TC-AUDIT-004: 按操作类型筛选
**测试目标**: 验证按操作类型筛选审计日志
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 进入审计日志页面
2. 在"操作类型"下拉框选择"创建"
3. 查看筛选结果

**预期结果**:
- 只显示创建操作的记录
- 其他操作类型不显示
- 筛选准确

**验证属性**: Property 27
**关联需求**: Requirements 6.3

---

### TC-AUDIT-005: 按实体类型筛选
**测试目标**: 验证按实体类型筛选审计日志
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 进入审计日志页面
2. 在"实体类型"下拉框选择"VM记录"
3. 查看筛选结果

**预期结果**:
- 只显示VM记录相关的操作
- 其他实体类型不显示
- 筛选准确

**验证属性**: Property 27
**关联需求**: Requirements 6.3

---

### TC-AUDIT-006: 按用户筛选
**测试目标**: 验证按用户筛选审计日志
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 进入审计日志页面
2. 在"用户"下拉框选择特定用户
3. 查看筛选结果

**预期结果**:
- 只显示该用户的操作记录
- 其他用户的操作不显示
- 筛选准确

**验证属性**: Property 27
**关联需求**: Requirements 6.3

---

### TC-AUDIT-007: 按时间范围筛选
**测试目标**: 验证按时间范围筛选审计日志
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 进入审计日志页面
2. 设置开始日期和结束日期
3. 查看筛选结果

**预期结果**:
- 只显示指定时间范围内的记录
- 时间范围外的记录不显示
- 筛选准确

**验证属性**: Property 27
**关联需求**: Requirements 6.3

---

### TC-AUDIT-008: 搜索审计日志
**测试目标**: 验证审计日志搜索功能
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 进入审计日志页面
2. 在搜索框输入关键字
3. 查看搜索结果

**预期结果**:
- 显示匹配的记录
- 搜索操作和实体相关字段
- 实时更新结果

---

### TC-AUDIT-009: 清除筛选条件
**测试目标**: 验证清除审计日志筛选
**前置条件**: 已应用筛选条件
**测试步骤**:
1. 应用多个筛选条件
2. 点击"清除筛选"按钮

**预期结果**:
- 所有筛选条件重置
- 显示所有审计记录
- 搜索框和日期选择器清空

---

### TC-AUDIT-010: 审计日志分页
**测试目标**: 验证审计日志分页功能
**前置条件**: 审计日志记录超过50条
**测试步骤**:
1. 进入审计日志页面
2. 查看分页信息
3. 点击"下一页"按钮

**预期结果**:
- 显示当前页码和总页数
- 显示记录范围（如1-50条，共200条）
- 可以翻页查看更多记录
- 第一页禁用"上一页"按钮
- 最后一页禁用"下一页"按钮

---

### TC-AUDIT-011: 刷新审计日志
**测试目标**: 验证刷新功能
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 进入审计日志页面
2. 点击"刷新"按钮

**预期结果**:
- 重新加载审计日志数据
- 显示最新的操作记录
- 保持当前筛选条件

---

### TC-AUDIT-012: 查看变更详情
**测试目标**: 验证变更内容显示
**前置条件**: 存在有变更内容的审计记录
**测试步骤**:
1. 进入审计日志页面
2. 查看某条记录的变更内容列

**预期结果**:
- 显示变更的字段和值
- 格式清晰易读
- 对于无变更的操作显示"无变更"

---
## 7. 权限控制测试

### TC-PERM-001: 管理员完整权限验证
**测试目标**: 验证管理员拥有所有功能权限
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 登录为管理员
2. 访问所有功能页面
3. 尝试所有操作

**预期结果**:
- 可以访问所有页面（仪表板、VM管理、项目管理、用户管理、审计日志）
- 可以执行所有CRUD操作
- 可以查看所有数据
- 可以执行批量操作
- 可以管理用户和权限

**验证属性**: Property 2
**关联需求**: Requirements 1.2

---

### TC-PERM-002: 普通用户权限限制
**测试目标**: 验证普通用户权限受限
**前置条件**: 以普通用户身份登录
**测试步骤**:
1. 登录为普通用户
2. 尝试访问各个功能

**预期结果**:
- 可以访问：仪表板、VM管理、项目管理
- 不能访问：用户管理、审计日志
- 只能查看分配项目的数据
- 不能执行创建、编辑、删除操作
- 不能执行批量操作

**验证属性**: Property 3, Property 4
**关联需求**: Requirements 1.3, 1.4

---

### TC-PERM-003: 项目数据隔离
**测试目标**: 验证普通用户只能访问分配项目的数据
**前置条件**: 普通用户只分配到"项目A"
**测试步骤**:
1. 登录为该普通用户
2. 查看VM列表
3. 尝试访问"项目B"的VM

**预期结果**:
- VM列表只显示"项目A"的VM
- 不显示"项目B"的VM
- 直接访问"项目B"的VM详情被拒绝
- 筛选条件中只显示"项目A"

**验证属性**: Property 4, Property 40
**关联需求**: Requirements 1.4, 9.2, 9.3

---

### TC-PERM-004: 未授权操作拦截
**测试目标**: 验证未授权操作被正确拦截
**前置条件**: 以普通用户身份登录
**测试步骤**:
1. 尝试直接访问管理员功能的URL
2. 尝试通过API执行未授权操作

**预期结果**:
- 页面访问被拒绝
- API请求返回403错误
- 显示权限不足提示
- 操作不被执行

**验证属性**: Property 3, Property 28
**关联需求**: Requirements 1.3, 6.4

---

### TC-PERM-005: 会话过期处理
**测试目标**: 验证会话过期后需要重新认证
**前置条件**: 用户已登录
**测试步骤**:
1. 登录系统
2. 等待会话过期（或手动清除会话）
3. 尝试访问受保护页面

**预期结果**:
- 被重定向到登录页面
- 显示会话过期提示
- 需要重新输入凭据
- 登录后可以继续使用

**验证属性**: Property 5
**关联需求**: Requirements 1.5

---

### TC-PERM-006: 跨项目访问控制
**测试目标**: 验证用户不能访问未分配项目的资源
**前置条件**: 普通用户分配到"项目A"，未分配到"项目B"
**测试步骤**:
1. 登录为该用户
2. 尝试通过URL直接访问"项目B"的VM详情
3. 尝试通过API查询"项目B"的数据

**预期结果**:
- 页面访问被拒绝或显示404
- API返回空结果或403错误
- 不泄露未授权项目的信息

**验证属性**: Property 40
**关联需求**: Requirements 9.3, 9.4

---

## 8. 数据导出测试

### TC-EXPORT-001: 导出VM数据为CSV
**测试目标**: 验证VM数据CSV导出功能
**前置条件**: 登录系统，存在VM数据
**测试步骤**:
1. 进入VM管理页面
2. 点击"导出CSV"按钮
3. 等待下载完成

**预期结果**:
- 文件成功下载
- 文件名格式正确（如vm-export-2026-01-06.csv）
- CSV文件包含所有VM字段
- 数据格式正确
- 包含表头行

**验证属性**: Property 42
**关联需求**: Requirements 12.5

---

### TC-EXPORT-002: 导出VM数据为JSON
**测试目标**: 验证VM数据JSON导出功能
**前置条件**: 登录系统，存在VM数据
**测试步骤**:
1. 进入VM管理页面
2. 点击"导出JSON"按钮
3. 等待下载完成

**预期结果**:
- 文件成功下载
- 文件名格式正确
- JSON格式有效
- 包含所有VM数据
- 数据结构完整

**验证属性**: Property 42
**关联需求**: Requirements 12.5

---

### TC-EXPORT-003: 导出项目数据
**测试目标**: 验证项目数据导出功能
**前置条件**: 登录系统，存在项目数据
**测试步骤**:
1. 进入项目管理页面
2. 点击"导出CSV"或"导出JSON"按钮
3. 等待下载完成

**预期结果**:
- 文件成功下载
- 包含所有项目信息
- 包含关联的VM数量和用户数量
- 数据准确完整

**验证属性**: Property 42
**关联需求**: Requirements 12.5

---

### TC-EXPORT-004: 导出审计日志
**测试目标**: 验证审计日志导出功能
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 进入审计日志页面
2. 可选：应用筛选条件
3. 点击"导出"按钮
4. 等待下载完成

**预期结果**:
- 文件成功下载
- 包含所有审计记录（或筛选后的记录）
- 包含所有审计字段
- 数据格式正确

**验证属性**: Property 42
**关联需求**: Requirements 12.5

---

### TC-EXPORT-005: 导出带筛选条件的数据
**测试目标**: 验证导出时应用筛选条件
**前置条件**: 登录系统
**测试步骤**:
1. 进入VM管理页面
2. 应用筛选条件（如选择特定项目）
3. 点击"导出CSV"按钮
4. 打开下载的文件

**预期结果**:
- 导出的数据只包含筛选后的记录
- 不包含被筛选掉的数据
- 数据与页面显示一致

---

### TC-EXPORT-006: 普通用户导出权限范围数据
**测试目标**: 验证普通用户只能导出权限范围内的数据
**前置条件**: 以普通用户身份登录
**测试步骤**:
1. 进入VM管理页面
2. 点击"导出CSV"按钮
3. 打开下载的文件

**预期结果**:
- 只导出用户有权访问的项目的VM
- 不包含其他项目的数据
- 数据与用户可见数据一致

**验证属性**: Property 40
**关联需求**: Requirements 9.4

---
## 9. 续期功能测试

### TC-RENEW-001: 单个VM续期
**测试目标**: 验证单个VM续期功能
**前置条件**: 以管理员身份登录，存在VM记录
**测试步骤**:
1. 进入VM详情页面
2. 点击"续期"按钮
3. 确认续期操作

**预期结果**:
- 上次到期时间更新为原本次到期时间
- 本次到期时间更新为新的到期时间（+3个月）
- 续期操作记录到审计日志
- 显示成功提示

**验证属性**: Property 21, Property 22, Property 23, Property 24
**关联需求**: Requirements 5.1, 5.2, 5.4, 5.5

---

### TC-RENEW-002: 自定义续期时间
**测试目标**: 验证自定义续期时间功能
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 进入VM编辑页面
2. 手动设置新的到期时间
3. 保存更改

**预期结果**:
- 到期时间更新为指定日期
- 历史记录保留
- 操作记录到审计日志

**验证属性**: Property 21
**关联需求**: Requirements 5.1

---

### TC-RENEW-003: 续期日期验证
**测试目标**: 验证续期日期必须是未来日期
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 尝试设置过去的到期时间
2. 尝试保存

**预期结果**:
- 显示验证错误
- 提示"到期时间必须是未来日期"
- 不更新记录

**验证属性**: Property 15
**关联需求**: Requirements 5.3

---

### TC-RENEW-004: 批量续期历史记录
**测试目标**: 验证批量续期保留历史
**前置条件**: 以管理员身份登录
**测试步骤**:
1. 选择多个VM
2. 执行批量续期
3. 查看每个VM的历史记录

**预期结果**:
- 每个VM的上次到期时间正确保存
- 每个VM的本次到期时间正确更新
- 历史记录完整

**验证属性**: Property 22
**关联需求**: Requirements 5.2

---

## 10. 通知功能测试

### TC-NOTIF-001: 到期提醒邮件发送
**测试目标**: 验证7天内到期的VM发送提醒邮件
**前置条件**: 存在7天内到期的VM，邮件服务配置正确
**测试步骤**:
1. 创建或修改VM，设置到期时间为7天后
2. 等待或手动触发定时任务
3. 检查邮件发送记录

**预期结果**:
- 系统发送到期提醒邮件
- 邮件发送到项目管理员
- 邮件包含VM详细信息和到期时间
- 发送状态记录到数据库

**验证属性**: Property 17, Property 18
**关联需求**: Requirements 4.1, 4.2

---

### TC-NOTIF-002: 邮件发送成功日志
**测试目标**: 验证邮件发送成功后记录日志
**前置条件**: 邮件服务正常
**测试步骤**:
1. 触发邮件发送
2. 查看通知日志

**预期结果**:
- 记录发送状态为"已发送"
- 记录发送时间
- 记录收件人信息
- 无错误信息

**验证属性**: Property 19
**关联需求**: Requirements 4.3

---

### TC-NOTIF-003: 邮件发送失败处理
**测试目标**: 验证邮件发送失败的处理机制
**前置条件**: 模拟邮件服务故障
**测试步骤**:
1. 配置错误的邮件服务设置
2. 触发邮件发送
3. 查看错误处理

**预期结果**:
- 记录发送状态为"失败"
- 记录错误信息
- 启动重试机制
- 不影响系统其他功能

**验证属性**: Property 20
**关联需求**: Requirements 4.4

---

### TC-NOTIF-004: 定时任务执行
**测试目标**: 验证定时任务每日执行
**前置条件**: 系统部署到Vercel，配置Cron Job
**测试步骤**:
1. 配置Vercel Cron Job
2. 等待定时任务执行
3. 查看执行日志

**预期结果**:
- 定时任务每日执行
- 检查所有即将到期的VM
- 发送相应的提醒邮件
- 记录执行日志

**关联需求**: Requirements 4.5

---

## 11. 错误处理测试

### TC-ERROR-001: 网络错误处理
**测试目标**: 验证网络错误的处理
**前置条件**: 模拟网络故障
**测试步骤**:
1. 断开网络连接
2. 尝试执行操作
3. 查看错误提示

**预期结果**:
- 显示友好的错误提示
- 不崩溃或白屏
- 提供重试选项
- 记录错误日志

**验证属性**: Property 29
**关联需求**: Requirements 7.5

---

### TC-ERROR-002: 数据验证错误
**测试目标**: 验证数据验证错误的提示
**前置条件**: 登录系统
**测试步骤**:
1. 尝试提交无效数据
2. 查看错误提示

**预期结果**:
- 显示具体的验证错误信息
- 标记错误字段
- 不提交数据
- 保留用户已输入的有效数据

---

### TC-ERROR-003: 权限错误处理
**测试目标**: 验证权限错误的处理
**前置条件**: 以普通用户身份登录
**测试步骤**:
1. 尝试访问管理员功能
2. 查看错误提示

**预期结果**:
- 显示"权限不足"提示
- 不执行未授权操作
- 不泄露敏感信息
- 提供返回或登录选项

---

### TC-ERROR-004: 数据库错误处理
**测试目标**: 验证数据库错误的处理
**前置条件**: 模拟数据库故障
**测试步骤**:
1. 模拟数据库连接失败
2. 尝试执行操作
3. 查看错误处理

**预期结果**:
- 显示友好的错误提示
- 不暴露数据库详细信息
- 记录详细错误日志
- 系统保持稳定

---

### TC-ERROR-005: 并发操作冲突
**测试目标**: 验证并发操作的冲突处理
**前置条件**: 多个用户同时操作
**测试步骤**:
1. 两个用户同时编辑同一条记录
2. 先后保存
3. 查看冲突处理

**预期结果**:
- 检测到数据冲突
- 提示用户数据已被修改
- 提供刷新或覆盖选项
- 保证数据一致性

---

## 12. 性能测试

### TC-PERF-001: 页面加载性能
**测试目标**: 验证页面加载速度
**前置条件**: 系统正常运行
**测试步骤**:
1. 清除浏览器缓存
2. 访问各个页面
3. 测量加载时间

**预期结果**:
- 首页加载时间 < 2秒
- 列表页加载时间 < 3秒
- 详情页加载时间 < 2秒
- 用户体验流畅

---

### TC-PERF-002: 大数据量列表性能
**测试目标**: 验证大数据量下的列表性能
**前置条件**: 系统中有大量数据（100+条记录）
**测试步骤**:
1. 访问VM列表页面
2. 测试滚动和筛选性能

**预期结果**:
- 列表渲染流畅
- 筛选响应及时
- 分页功能正常
- 无明显卡顿

---

### TC-PERF-003: 批量操作性能
**测试目标**: 验证批量操作的性能
**前置条件**: 选择大量VM（50+）
**测试步骤**:
1. 选择50个以上的VM
2. 执行批量续期
3. 测量执行时间

**预期结果**:
- 操作在合理时间内完成（< 10秒）
- 显示进度提示
- 不阻塞UI
- 操作成功完成

---

## 13. 浏览器兼容性测试

### TC-COMPAT-001: Chrome浏览器兼容性
**测试目标**: 验证在Chrome浏览器中的兼容性
**测试步骤**: 在Chrome浏览器中执行所有核心功能
**预期结果**: 所有功能正常工作，UI显示正确

---

### TC-COMPAT-002: Firefox浏览器兼容性
**测试目标**: 验证在Firefox浏览器中的兼容性
**测试步骤**: 在Firefox浏览器中执行所有核心功能
**预期结果**: 所有功能正常工作，UI显示正确

---

### TC-COMPAT-003: Edge浏览器兼容性
**测试目标**: 验证在Edge浏览器中的兼容性
**测试步骤**: 在Edge浏览器中执行所有核心功能
**预期结果**: 所有功能正常工作，UI显示正确

---

### TC-COMPAT-004: 移动端响应式布局
**测试目标**: 验证移动端响应式布局
**测试步骤**: 
1. 使用移动设备或浏览器开发者工具
2. 测试各个页面的显示
**预期结果**: 
- 布局自适应屏幕大小
- 所有功能可访问
- 触摸操作正常

---

## 测试总结

### 测试覆盖范围
本测试用例文档覆盖了VM到期管理系统的所有主要功能模块：
- ✅ 认证和授权（6个测试用例）
- ✅ 仪表板功能（2个测试用例）
- ✅ VM管理（17个测试用例）
- ✅ 项目管理（11个测试用例）
- ✅ 用户管理（10个测试用例）
- ✅ 审计日志（12个测试用例）
- ✅ 权限控制（6个测试用例）
- ✅ 数据导出（6个测试用例）
- ✅ 续期功能（4个测试用例）
- ✅ 通知功能（4个测试用例）
- ✅ 错误处理（5个测试用例）
- ✅ 性能测试（3个测试用例）
- ✅ 浏览器兼容性（4个测试用例）

**总计：90个测试用例**

### 测试执行建议
1. **优先级P0（核心功能）**: 认证、VM CRUD、项目CRUD、权限控制
2. **优先级P1（重要功能）**: 筛选搜索、批量操作、审计日志、数据导出
3. **优先级P2（辅助功能）**: 通知、续期、错误处理、性能测试

### 自动化测试建议
建议将以下测试用例自动化：
- 认证流程测试
- CRUD操作测试
- 权限控制测试
- 数据验证测试
- API接口测试

### 测试环境要求
- Node.js 18+
- PostgreSQL数据库
- 邮件服务配置
- 测试数据初始化脚本
- 浏览器：Chrome、Firefox、Edge最新版本

---

**文档结束**
